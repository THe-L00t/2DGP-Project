
# 충돌 블럭 에디터 사용 가이드

## 개요
배경 이미지 기반 맵 시스템에 충돌 블럭을 실시간으로 추가/수정/삭제할 수 있는 에디터 기능입니다.

---

## 시스템 활성화 방법

### 1. 배경 맵 모드로 전환
`play_scene.py` 파일 상단의 변수를 수정합니다:

```python
use_background_map = True  # False를 True로 변경
```

### 2. 배경 이미지 설정
`play_scene.py`의 `enter()` 함수에서 배경 이미지 경로를 설정합니다:

```python
# 주석 해제 후 경로 수정
background_map.load_background('resource/your_background_image.png')
```

### 3. 게임 실행
```bash
python main.py
```

---

## 에디터 조작 방법

### 기본 키 바인딩

| 키 | 기능 | 비고 |
|---|------|------|
| **9** | 충돌 블럭 에디터 ON/OFF | 에디터 모드 토글 |
| **8** | 충돌 데이터 저장 | `maps/collision_data.json`에 저장 |
| **0** | 충돌 박스 표시 ON/OFF | 에디터 꺼도 충돌 박스 확인 가능 |
| **ESC** | 게임 종료 | - |

---

## 에디터 모드 조작

### 충돌 블럭 생성
1. **9키**를 눌러 에디터 모드 활성화
2. **마우스 왼쪽 버튼 드래그**로 사각형 영역 그리기
3. 마우스를 놓으면 충돌 블럭 생성 완료

```
[드래그 시작점] -----> [드래그 끝점]
       ┌────────────────┐
       │   충돌 블럭     │
       └────────────────┘
```

### 충돌 블럭 선택 및 이동
1. 기존 블럭을 **마우스 왼쪽 클릭**하여 선택 (초록색으로 표시)
2. 선택된 상태에서 **마우스 드래그**로 위치 이동

### 충돌 블럭 크기 조절
선택된 블럭의 크기를 화살표 키로 조절:

| 키 | 효과 |
|---|------|
| **←** (왼쪽 화살표) | 너비 -10 픽셀 |
| **→** (오른쪽 화살표) | 너비 +10 픽셀 |
| **↑** (위쪽 화살표) | 높이 +10 픽셀 |
| **↓** (아래쪽 화살표) | 높이 -10 픽셀 |

### 충돌 블럭 삭제

**방법 1**: 마우스 우클릭
- 삭제할 블럭을 **마우스 오른쪽 버튼 클릭**

**방법 2**: 키보드 삭제
- 블럭을 선택한 후 **Delete** 또는 **Backspace** 키

---

## 시각적 피드백

### 블럭 색상
- **빨간색 (반투명)**: 일반 충돌 블럭
- **초록색 (반투명)**: 선택된 충돌 블럭

### 에디터 모드 상태 확인
에디터 모드가 켜지면 콘솔에 다음 메시지가 출력됩니다:
```
충돌 블럭 에디터: ON
```

---

## 데이터 저장 및 로드

### 자동 저장 경로
```
maps/collision_data.json
```

### 저장 방법
1. 에디터 모드에서 충돌 블럭 배치 완료
2. **8키**를 눌러 저장
3. 콘솔 메시지 확인:
   ```
   충돌 데이터 저장 완료: maps/collision_data.json (N개 블럭)
   ```

### 로드 방법
게임 시작 시 자동으로 `maps/collision_data.json` 파일을 로드합니다.
파일이 없으면 빈 상태로 시작됩니다.

### 데이터 포맷 (JSON)
```json
{
  "blocks": [
    {
      "x": 400,
      "y": 300,
      "width": 200,
      "height": 100
    },
    {
      "x": 800,
      "y": 500,
      "width": 150,
      "height": 150
    }
  ]
}
```

---

## 작업 흐름 예시

### 새 맵 제작 과정
1. **배경 이미지 준비** (PNG 파일)
2. `play_scene.py`에서 `use_background_map = True` 설정
3. 배경 이미지 경로 지정
4. 게임 실행
5. **9키**로 에디터 모드 진입
6. 벽/바닥/장애물 영역에 충돌 블럭 배치
   - 마우스 드래그로 블럭 생성
   - 화살표 키로 미세 조정
   - 우클릭으로 불필요한 블럭 삭제
7. **8키**로 저장
8. **9키**로 에디터 모드 종료
9. **0키**로 충돌 박스 확인 (선택사항)
10. 게임 플레이로 충돌 테스트

### 기존 맵 수정 과정
1. 게임 실행 (자동으로 기존 데이터 로드)
2. **9키**로 에디터 모드 진입
3. 충돌 블럭 수정
   - 클릭으로 선택 후 드래그로 이동
   - 화살표 키로 크기 조절
   - 우클릭으로 삭제
4. **8키**로 저장
5. **9키**로 에디터 모드 종료

---

## 주의사항

### 1. 에디터 모드 중 캐릭터 조작 불가
에디터 모드가 켜져 있으면:
- 캐릭터 이동 불가
- 캐릭터 공격 불가
- 캐릭터 전환 불가

→ **9키**로 에디터를 끄면 정상 플레이 가능

### 2. 최소 블럭 크기
- 너비/높이가 10픽셀 미만인 블럭은 생성되지 않습니다.

### 3. 저장하지 않고 종료 시
작업한 충돌 블럭이 사라집니다.
**반드시 8키로 저장**한 후 게임을 종료하세요.

### 4. 카메라 이동
에디터 모드에서도 카메라는 캐릭터를 따라갑니다.
멀리 있는 영역을 편집하려면:
- 일시적으로 에디터를 끄고 캐릭터를 이동시킨 후
- 다시 에디터 모드를 켜서 작업

---

## 기존 타일맵 시스템과의 차이

| 항목 | 기존 타일맵 | 새 배경 맵 |
|------|------------|------------|
| 배경 | 타일 조합 (64x64) | 이미지 통째로 로드 |
| 충돌 처리 | 타일 타입별 자동 | 에디터로 직접 배치 |
| 맵 제작 | JSON 수동 편집 | 실시간 시각적 편집 |
| 유연성 | 그리드 제약 | 자유로운 배치 |
| 전환 | `use_background_map = False` | `use_background_map = True` |

---

## 충돌 처리 API (개발자용)

### BackgroundMap 클래스 주요 메서드

```python
# 충돌 체크 (단일)
if background_map.check_collision(x, y, width, height):
    print("충돌 발생!")

# 충돌하는 모든 블럭 가져오기
blocks = background_map.get_colliding_blocks(x, y, width, height)
for block in blocks:
    print(f"충돌 블럭: {block.x}, {block.y}")

# 특정 좌표에 있는 블럭 찾기
block = background_map.get_block_at_point(world_x, world_y)
if block:
    print("블럭 발견!")
```

### 캐릭터 충돌 처리 예시

```python
# play_scene.py의 update() 함수에 추가
if use_background_map and background_map:
    # 캐릭터가 충돌 블럭과 겹치는지 확인
    char_x, char_y = warrior.x, warrior.y
    char_w, char_h = 40, 40

    if background_map.check_collision(char_x, char_y, char_w, char_h):
        # 충돌 시 처리 (예: 이전 위치로 되돌리기)
        warrior.x = prev_x
        warrior.y = prev_y
```

---

## 트러블슈팅

### Q1. 에디터 모드가 켜지지 않아요
**A**: `use_background_map = True`로 설정했는지 확인하세요.

### Q2. 배경 이미지가 안 보여요
**A**:
1. 이미지 경로가 올바른지 확인
2. 콘솔에 "배경 이미지 로드" 메시지가 있는지 확인
3. 이미지 파일 형식이 PNG인지 확인

### Q3. 블럭을 생성했는데 안 보여요
**A**:
1. 충돌 박스 표시 (**0키**)를 켜보세요
2. 너무 작게 그리지 않았는지 확인 (10픽셀 이상)

### Q4. 저장한 데이터가 로드 안 돼요
**A**:
1. `maps/` 폴더가 존재하는지 확인
2. `collision_data.json` 파일이 있는지 확인
3. JSON 파일 문법 오류 확인

### Q5. 에디터 모드에서 캐릭터가 안 움직여요
**A**: 정상입니다. 에디터 모드를 끄면 (**9키**) 다시 움직입니다.

---

## 단축키 요약

```
===========================================
  충돌 블럭 에디터 단축키
===========================================
[9] : 에디터 모드 ON/OFF
[8] : 충돌 데이터 저장
[0] : 충돌 박스 표시 ON/OFF

--- 에디터 모드 중 ---
[마우스 왼쪽 드래그] : 블럭 생성
[마우스 왼쪽 클릭] : 블럭 선택/이동
[마우스 오른쪽 클릭] : 블럭 삭제
[←→↑↓] : 선택된 블럭 크기 조절
[Delete/Backspace] : 선택된 블럭 삭제

--- 일반 모드 ---
[화살표 키] : 캐릭터 이동
[A] : 공격
[F] : 캐릭터 전환
[I] : 인벤토리
[ESC] : 게임 종료
===========================================
```

---

## 버전 정보
- 작성일: 2025-11-14
- 시스템: 배경 맵 기반 충돌 블럭 에디터 v1.0
- 호환: pico2d, Python 3.x

---

## 참고
- `background_map.py`: 메인 시스템 구현
- `play_scene.py`: 에디터 통합 및 이벤트 처리
- `maps/collision_data.json`: 충돌 데이터 저장 파일
