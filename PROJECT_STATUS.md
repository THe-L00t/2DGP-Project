# 2DGP Project - 현재 진행상황

> 최종 업데이트: 2025-11-25
> 브랜치: main
> 커밋: 5a5c7a9 (맵 세팅 준비 완료)

## 목차
- [프로젝트 개요](#프로젝트-개요)
- [게임 시스템](#게임-시스템)
- [구현 완료 기능](#구현-완료-기능)
- [미완성 작업](#미완성-작업)
- [파일 구조](#파일-구조)
- [게임 밸런스](#게임-밸런스)
- [다음 작업](#다음-작업)

---

## 프로젝트 개요

**장르**: 2D 액션 RPG (탑다운 뷰)
**엔진**: pico2d (Python 기반)
**해상도**: 1024x768
**맵 크기**: 40x40 타일 (2560x2560px)

### 플레이어 캐릭터
- **전사 (Warrior)**: 메인 전투 캐릭터
- **아이 (Child)**: 비전투 서포트 캐릭터
- F키로 실시간 전환 가능

### 적 캐릭터
- **놈 (Gnome)**: 순찰/추적/공격 AI
- **패들피쉬 (Paddlefish)**: 피격 반응형 추격 AI
- **판다 (Panda)**: 원형 순찰 + 가드 상태 AI

---

## 게임 시스템

### 1. 캐릭터 시스템

#### 전사 (warior.py - 416줄)
```
상태: IDLE, RUN, ATTACK1, ATTACK2
스탯:
  - HP: 200
  - 이동속도: 300 px/sec
  - 공격력: 30 (기본) / 50 (콤보)
  - 콤보 윈도우: 0.5초
기능:
  - 8방향 이동
  - 2단 콤보 공격 (타이밍 기반)
  - 공격 넉백 (20px)
  - 프레임 기반 공격 판정
    * ATTACK1: [1,2] 프레임
    * ATTACK2: [1,2,3] 프레임
```

#### 아이 (child.py - 188줄)
```
상태: IDLE, RUN
스탯:
  - HP: 100
  - 이동속도: 250 px/sec
  - 공격력: 없음
기능:
  - 8방향 이동만 가능
  - 몬스터 공격 대상이 될 수 있음
  - 피격 시 넉백 받음
```

### 2. 적 AI 시스템

#### Gnome (gnome.py - 492줄)
```
상태: IDLE, RUN, CHASE, ATTACK
스탯: HP 100, 공격력 15
행동패턴:
  1. IDLE/RUN: 8방향 무작위 순찰 (2초 간격)
  2. 탐지: 300px 이내 플레이어 감지
  3. CHASE: 플레이어 추격
  4. ATTACK: 50px 이내 공격 (2초 쿨다운)
  5. 공격 판정: 6프레임 애니메이션 중 3-4프레임
```
⚠️ **문제점**: `gnome.py:104,156,265,331` - 프레임 크기 조정 필요

#### Paddlefish (paddlefish.py - 521줄)
```
상태: IDLE, RUN, CHASE, ATTACK
스탯: HP 80, 공격력 12
행동패턴:
  1. 평상시: 150 px/sec 순찰
  2. 피격 시: CHASE 모드 활성화 (250 px/sec)
  3. 추격 지속: 5초간 (매 피격마다 리셋)
  4. 공격 박스: 120x95 (Gnome보다 큼)
특징: 공격받을 때마다 추격 타이머 갱신
```

#### Panda (panda.py - 372줄)
```
상태: IDLE, ATTACK, GUARD, RUN
스탯: HP 120
행동패턴:
  1. RUN: 원형 순찰 (반지름 100px, 회전속도 2.0)
  2. ATTACK/GUARD/RUN 랜덤 전환
  3. GUARD: 방어 상태
특징: 덜 공격적, 방어 메커니즘 보유
```
⚠️ **문제점**: `panda.py` 전반 - 프레임 카운트 불일치 (256x256 vs 192x192)

### 3. 전투 시스템 (play_scene.py)

#### 충돌 검사
```python
# 플레이어 → 몬스터 공격
for monster in monsters:
    monster.handle_collision(current_character)

# 몬스터 → 플레이어 공격
for monster in monsters:
    if monster.get_attack_bb() intersects current_character.get_bb():
        current_character.take_damage(...)
```

#### 데미지 처리
- 공격자 기준 `hit_targets` 세트로 중복 피격 방지
- 프레임 기반 활성화 (특정 애니메이션 프레임에서만 판정)
- 넉백: 공격자 X좌표 기준 20px 밀림
- HP 0 이하 시 객체 제거

### 4. 맵 시스템 (tile.py - 445줄)

#### 타일 종류 (18개)
```
0: OCEAN - 바다 (충돌 없음)
1-9: TILEMAP - 지형 타일
  TOP_LEFT(1), TOP(2), TOP_RIGHT(3)
  LEFT(4), CENTER(5), RIGHT(6)
  BOTTOM_LEFT(7), BOTTOM(8), BOTTOM_RIGHT(9)
10-11: STAIRS - 계단 (2레이어)
12-14: WAVES - 파도 장식 (충돌 없음)
15-17: CLIFFS - 절벽 (충돌 있음)
```

#### 충돌 시스템
```python
# tile.py - COLLISION_BOXES 딕셔너리
TOP_LEFT: [(0,0,20,64), (0,44,64,64)]  # L자형
TOP: [(0,44,64,64)]                     # 상단만
CENTER: None                            # 통과 가능
CLIFF_*: 전체 타일 충돌
```

#### 현재 맵 (map_data.py)
- 크기: 40x40 타일
- 레이아웃: 테두리 충돌 타일로 둘러싸인 플레이 공간
- 타일 크기: 64x64px

### 5. 카메라 시스템 (camera.py)

```python
# 부드러운 캐릭터 추적
Lerp 보간: lerp_speed = 5.0
화면 중앙: 현재 캐릭터 위치 기준
```

### 6. 상태 머신 (state_machine.py - 25줄)

```python
# 제네릭 상태 머신 (모든 캐릭터/몬스터 사용)
- start(state_name)
- add_event(event) / update()
- set_transitions(state_name, event_dictionary)
- draw()
```

---

## 구현 완료 기능

### ✅ 핵심 게임플레이
- [x] 8방향 이동 시스템
- [x] 캐릭터 전환 (F키)
- [x] 콤보 공격 시스템
- [x] 프레임 기반 공격 판정
- [x] 넉백 효과
- [x] HP/데미지 시스템

### ✅ 적 AI
- [x] 순찰 패턴 (Gnome, Paddlefish)
- [x] 추적 시스템 (탐지 범위)
- [x] 공격 쿨다운
- [x] 피격 반응 (Paddlefish)
- [x] 원형 순찰 (Panda)
- [x] 상태 전환 로직

### ✅ 맵 시스템
- [x] 타일맵 렌더링
- [x] 다층 타일 지원 (계단)
- [x] 타일별 커스텀 충돌 박스
- [x] 맵 경계 충돌 처리
- [x] 카메라 추적

### ✅ 씬 관리
- [x] 타이틀 화면 (title_scene.py)
- [x] 메인 게임 화면 (play_scene.py)
- [x] 인벤토리 오버레이 (inventory_scene.py)
- [x] 씬 전환 시스템 (game_framework.py)

### ✅ 디버그 기능
- [x] 충돌 박스 시각화 (0키)
- [x] 타일맵 디버그 모드 (9키)

---

## 미완성 작업

### 🔴 우선순위: 높음

#### 1. 애니메이션 프레임 오류
**파일**: `gnome.py`
```
위치: 104, 156, 265, 331줄
문제: "TODO: 프레임 크기를 실제 이미지에 맞게 수정하세요"
내용: 스프라이트 프레임 크기와 코드 불일치
```

**파일**: `panda.py`
```
위치: 전반적
문제: 프레임 카운트 오류
내용: Panda는 256x256 프레임 사용 (다른 캐릭터는 192x192)
      코드에서 % 10 연산이 정확한지 확인 필요
```

#### 2. 히트박스 조정
**파일**: `gnome.py:420`
```python
# TODO: 히트박스 크기를 몬스터에 맞게 조정
def get_bb(self):
    return self.x - 50, self.y - 50, self.x + 50, self.y + 50
```

**파일**: `panda.py:268, 279`
```python
# TODO: 히트박스 크기를 정확하게 조정
# TODO: 공격 범위 조정
```

### 🟡 우선순위: 중간

#### 3. 타이틀 화면
**파일**: `title_scene.py:15`
```python
# TODO: 타이틀 배경 이미지 로드
# 파일 누락: resource/title.png
```

#### 4. 인벤토리 UI
**파일**: `inventory_scene.py:320`
```python
# TODO: UI 텍스트 추가 (pico2d 폰트 필요)
# 현재 상태: 빈 박스만 그려짐
# 필요 작업:
#   - 아이템 목록 표시
#   - 텍스트 렌더링
#   - 아이템 선택 기능
```

### 🟢 우선순위: 낮음

#### 5. 미사용 시스템 정리
**파일**: `background_map.py`
```
상태: 완전한 충돌 에디터 시스템 존재
문제: 메인 게임에 통합 안 됨
관련: collision_data.json (비어있음)
결정 필요: 삭제 또는 통합
```

#### 6. 키 바인딩 문제
**파일**: `play_scene.py`
```python
# F3 키가 pico2d/SDL2에서 작동 안 함
# 해결: 9키로 변경 (최근 수정됨)
```

---

## 파일 구조

### 핵심 파일

```
main.py (엔트리 포인트)
 └─ game_framework.py (씬 관리자 - 95줄)
     └─ title_scene.py (타이틀 - 스페이스/엔터로 시작)
         └─ play_scene.py (메인 게임 - 322줄)
             ├─ Characters
             │   ├─ warior.py (416줄) ✅
             │   └─ child.py (188줄) ✅
             ├─ Monsters
             │   ├─ gnome.py (492줄) ⚠️ 프레임 수정 필요
             │   ├─ paddlefish.py (521줄) ✅
             │   └─ panda.py (372줄) ⚠️ 프레임 수정 필요
             ├─ Map
             │   ├─ tile.py (445줄) ✅ 충돌 시스템 완성
             │   └─ map_data.py (98줄) ✅ 맵 데이터
             ├─ Systems
             │   ├─ camera.py ✅
             │   ├─ state_machine.py (25줄) ✅
             │   └─ event_check.py ✅
             └─ UI
                 └─ inventory_scene.py (I키) ⚠️ UI 미완성
```

### 보조 파일
```
event_to_string.py - 이벤트 디버깅 유틸
background_map.py - 미사용 충돌 에디터
```

### 리소스
```
resource/ - 캐릭터/타일 스프라이트 이미지
  ├─ warrior/ - 전사 애니메이션
  ├─ child/ - 아이 애니메이션
  ├─ gnome/ - 놈 애니메이션
  ├─ paddlefish/ - 패들피쉬 애니메이션
  ├─ panda/ - 판다 애니메이션
  ├─ tiles/ - 타일셋
  └─ title.png ❌ 누락

maps/ - 맵 데이터
  └─ collision_data.json (비어있음)
```

---

## 게임 밸런스

### 캐릭터 스탯 비교
| 캐릭터 | HP | 이동속도 | 공격력 | 특징 |
|--------|-----|----------|--------|------|
| 전사 | 200 | 300 | 30/50 | 콤보 공격 |
| 아이 | 100 | 250 | - | 비전투 |

### 몬스터 스탯 비교
| 몬스터 | HP | 공격력 | 탐지범위 | 공격범위 | 특징 |
|--------|-----|--------|----------|----------|------|
| Gnome | 100 | 15 | 300px | 50px | 기본 추적 AI |
| Paddlefish | 80 | 12 | 피격 반응 | 넓음(120x95) | 피격 시 5초 추격 |
| Panda | 120 | ? | - | - | 가드 상태, 덜 공격적 |

### 공격 판정 프레임
```
전사 ATTACK1: 총 4프레임, 판정 [1,2]
전사 ATTACK2: 총 6프레임, 판정 [1,2,3]
Gnome ATTACK: 총 6프레임, 판정 [3,4]
```

---

## 컨트롤

### 플레이어
| 키 | 기능 |
|----|------|
| ↑↓←→ | 8방향 이동 |
| A | 공격 (0.5초 내 재입력 시 콤보) |
| F | 전사 ↔ 아이 전환 |
| I | 인벤토리 열기/닫기 |
| ESC | 게임 종료 |

### 디버그
| 키 | 기능 |
|----|------|
| 0 | 충돌 박스 표시 ON/OFF |
| 9 | 타일맵 디버그 모드 ON/OFF |

---

## 최근 커밋 히스토리

```
5a5c7a9 맵 세팅 준비 완료
d0af70e 맵 수정 및 충돌처리
17f5296 다시 타일맵 부활
1321800 맵 파일 제작중
05587e4 gnome 패턴 일부 수정
```

### 현재 수정된 파일 (Git Status)
```
M gnome.py - TODO 주석 정리
M play_scene.py - 디버그 키 F3→9 변경
```

---

## 다음 작업

### 즉시 수행 가능
1. **애니메이션 프레임 수정** (gnome.py, panda.py)
   - 실제 스프라이트 시트 크기 확인
   - 프레임 인덱스 조정
   - 테스트

2. **히트박스 조정** (gnome.py, panda.py)
   - 캐릭터 스프라이트에 맞게 박스 크기 조정
   - 시각적으로 확인 (0키 디버그 모드)

3. **타이틀 이미지 추가**
   - `resource/title.png` 제작 또는 임시 이미지 배치

### 기능 확장
4. **인벤토리 UI 완성**
   - 아이템 시스템 설계
   - 텍스트 렌더링 (폰트 추가)
   - 아이템 획득/사용 로직

5. **추가 게임 콘텐츠**
   - 새로운 적 추가
   - 아이템 드랍 시스템
   - 레벨/스테이지 시스템
   - 체력바 UI

### 시스템 개선
6. **사운드 시스템**
   - 배경음악
   - 효과음 (공격, 피격, 발소리)

7. **세이브/로드 시스템**

---

## 알려진 이슈

1. ❌ `resource/title.png` 파일 누락
2. ⚠️ Gnome 애니메이션 프레임 크기 불일치
3. ⚠️ Panda 프레임 카운트 오류
4. ⚠️ 히트박스 크기 조정 필요
5. ⚠️ 인벤토리 UI 미완성
6. ❓ `background_map.py` 시스템 미사용 (삭제 여부 결정 필요)
7. ✅ F3 키 바인딩 문제 → 9키로 해결됨

---

## 전체 완성도

```
████████████████░░░░  75%

✅ 완성: 핵심 게임플레이, 전투, AI, 맵, 카메라
⚠️ 진행중: 애니메이션 튜닝, 히트박스 조정
❌ 미완성: UI 시스템, 사운드, 추가 콘텐츠
```

---

## 참고사항

### 개발 환경
- Python 3.x
- pico2d 라이브러리
- Windows 환경 (경로 구분자: \\)

### 코드 스타일
- 상태 머신 패턴 사용
- 이벤트 기반 입력 처리
- 프레임 기반 애니메이션
- 충돌 검사: AABB (Axis-Aligned Bounding Box)

### 좌표계
- 원점: 좌측 하단
- X축: 오른쪽 양수
- Y축: 위쪽 양수
- 화면 크기: 1024x768

---

**문서 작성**: AI Assistant
**프로젝트 경로**: `C:\Users\sigun\University\2-2\2DGameProgramming\2DGP-Project`
